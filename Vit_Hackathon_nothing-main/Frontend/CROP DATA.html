<!DOCTYPE html>
<html>

<head>
    <title>Crop Data & Bar Chart</title>
    <link rel="stylesheet" href="styles.css">
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script>
        google.charts.load('current', { packages: ['corechart'] });

        function submitData() {
            var tokenNumber = document.getElementById("tokenNumber").value;
            var cropName = document.getElementById("cropName").value;
            var acres = document.getElementById("acres").value;

            if (!tokenNumber || !cropName || !acres) {
                alert("Please fill in all fields!");
                return;
            }

            google.script.run.withSuccessHandler(function (response) {
                alert(response);
                document.getElementById("dataForm").reset();
                drawChart(); // Refresh chart after submission
            }).saveData(tokenNumber, cropName, acres);
        }

        function drawChart() {
            google.script.run.withSuccessHandler(function (chartData) {
                var data = google.visualization.arrayToDataTable(chartData);

                var options = {
                    title: 'Crop Acres Data (Usage & Required %)',
                    chartArea: { width: '60%' },
                    hAxis: {
                        title: 'Acres of Land',
                        minValue: 0
                    },
                    vAxis: {
                        title: 'Crop Name'
                    },
                    bars: 'horizontal',
                    annotations: {
                        alwaysOutside: true,
                        textStyle: {
                            fontName: 'Comic Sans MS',
                            fontSize: 14,
                            bold: true,
                            color: 'red'
                        }
                    },
                    colors: ['#4CAF50']
                };

                var chart = new google.visualization.BarChart(document.getElementById('chart_div'));
                chart.draw(data, options);
            }).getChartData();
        }

        google.charts.setOnLoadCallback(drawChart);
    </script>
</head>

<body style="font-family: var(--font-primary); margin: var(--spacing-lg); text-align: center; background: url('https://tracextech.com/wp-content/uploads/2024/05/Fair-Pricing-for-Farmers--scaled.jpg') no-repeat center center fixed; background-size: cover;">

    <header class="header">
        <div class="container">
            <h1>Crop Data Collection & Bar Chart</h1>
        </div>
    </header>

    <div class="container">
        <div class="form-container" style="display: inline-block; text-align: left; background: rgba(255, 255, 255, 0.9); margin-bottom: var(--spacing-xl);">
            <form id="dataForm">
                <div class="form-group">
                    <label class="form-label">Token Number:</label>
                    <input type="text" id="tokenNumber" class="form-input" required>
                </div>

                <div class="form-group">
                    <label class="form-label">Crop Name:</label>
                    <input type="text" id="cropName" class="form-input" required>
                </div>

                <div class="form-group">
                    <label class="form-label">Acres of Land:</label>
                    <input type="number" id="acres" class="form-input" required>
                </div>

                <button type="button" class="btn" onclick="submitData()">Submit</button>
            </form>
        </div>

        <div class="card" style="background: rgba(255, 255, 255, 0.9);">
            <h2>Bar Chart (Crop Acres Data)</h2>
            <div id="chart_div" style="width: 100%; height: 400px;"></div>
        </div>
    </div>
</body>

</html>